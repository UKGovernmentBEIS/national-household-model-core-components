<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Scenario Language Changelog</title>
  <section xml:id="reading-the-changelog">
    <title>Reading the Changelog</title>
    <para>
      This is the changelog for the National Household Model's Scenario
      Language. Each section covers the major changes introduced in a
      particular version of the NHM. The changes are usually under these
      headings:
    </para>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          <emphasis role="strong">Semantic changes</emphasis> are
          changes that may affect the meaning of existing scenarios, so
          if you run an old scenario its results may change
        </para>
      </listitem>
      <listitem>
        <para>
          <emphasis role="strong">New features</emphasis> are new
          commands or arguments to existing commands which enable the
          model to do new things
        </para>
      </listitem>
      <listitem>
        <para>
          <emphasis role="strong">Obsolete features</emphasis> are
          features which may be removed in a future version of the
          model, because they are superseded
        </para>
      </listitem>
      <listitem>
        <para>
          <emphasis role="strong">Bugs removed</emphasis> will list any
          known errors that were found to affect the previous version
          which have been corrected in this version
        </para>
      </listitem>
    </itemizedlist>
  </section>
  <section xml:id="released-versions">
    <title>Released versions</title>
    <section xml:id="version-7.2.0">
      <title>Version 7.2.0</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <itemizedlist>
            <listitem>
              <para>
                The hot water heating efficiency penalty associated with
                lack of a boiler interlock was not being applied in for
                cases where the summer and winter efficiency for the
                boiler are equal.
              </para>
              <para>
                This has a small impact on energy use (mean average of a
                1.7% increase) in a small number of affected cases
                (about 350 cases in the 2014 stock):
              </para>
              <figure>
                <title>Weighted histogram of percentage change in
                SAP2012 total energy use due to correct application of
                boiler interlock penalty in all cases.</title>
                <mediaobject>
                  <imageobject>
                    <imagedata fileref="./figures/interlock-sap.png" />
                  </imageobject>
                  <textobject><phrase>Weighted histogram of percentage
                  change in SAP2012 total energy use due to correct
                  application of boiler interlock penalty in all
                  cases.</phrase></textobject>
                </mediaobject>
              </figure>
            </listitem>
            <listitem>
              <para>
                In SAP mode, the model now uses SAP table S8B for
                party-wall u-values instead of SAP table 3.6. It also
                takes S8B to indicate that party walls for flats have a
                u-value of zero in all cases. Both these decisions
                follow direction from the BRE.
              </para>
              <para>
                The effect of this is as follows:
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    Masonry cavity party walls in flats now have a
                    u-value of zero. Previously, insulated cavity party
                    walls would have a u-value of 0.5.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Insulated masonry cavity party walls in non-flats
                    now have a u-value of 0.2. Previously, they would
                    have had a u-value of zero.
                  </para>
                </listitem>
              </itemizedlist>
              <para>
                This has a significant impact on energy use for affected
                dwellings. There are around 5000 affected cases in the
                2014 stock:
              </para>
              <figure>
                <title>Weighted histogram of percentage change in
                SAP2012 total energy use due to use of table S8B. Cases
                with no error are omitted; this is a subset of the total
                2014 stock population.</title>
                <mediaobject>
                  <imageobject>
                    <imagedata fileref="./figures/party-sap.png" />
                  </imageobject>
                  <textobject><phrase>Weighted histogram of percentage
                  change in SAP2012 total energy use due to use of table
                  S8B. Cases with no error are omitted; this is a subset
                  of the total 2014 stock
                  population.</phrase></textobject>
                </mediaobject>
              </figure>
            </listitem>
            <listitem>
              <para>
                A small bug which caused an error during validation of
                scenarios with an invalid stock file name has been
                removed. This should make the desktop application a
                little bit better behaved.
              </para>
            </listitem>
            <listitem>
              <para>
                A typo in the representative UK latitude (35.5 degrees,
                as opposed to 53.5) caused reduced solar gains and less
                useful daylight for lighting. The representative
                latitude is only used in SAP mode, so there is no effect
                on BREDEM mode calculations.
              </para>
              <figure>
                <title>Weighted scatterplot of error in SAP score due to
                latitude error, for EHS 2012 stock. Cases with no error
                are omitted to make the graph readable, and are visible
                in the histogram below.</title>
                <mediaobject>
                  <imageobject>
                    <imagedata fileref="./figures/score-bug/score-xy.png" />
                  </imageobject>
                  <textobject><phrase>Weighted scatterplot of error in
                  SAP score due to latitude error, for EHS 2012 stock.
                  Cases with no error are omitted to make the graph
                  readable, and are visible in the histogram
                  below.</phrase></textobject>
                </mediaobject>
              </figure>
              <figure>
                <title>Weighted histogram of error in SAP score due to
                latitude error, for EHS 2012 stock, including all
                cases.</title>
                <mediaobject>
                  <imageobject>
                    <imagedata fileref="./figures/score-bug/score-histogram.png" />
                  </imageobject>
                  <textobject><phrase>Weighted histogram of error in SAP
                  score due to latitude error, for EHS 2012 stock,
                  including all cases.</phrase></textobject>
                </mediaobject>
              </figure>
              <figure>
                <title>Scatterplot of error in energy use (in SAP mode)
                due to latitude error, for EHS 2012 stock. This figure
                is restricted to houses with energy use below 200,000
                kWh/year, for clarity.</title>
                <mediaobject>
                  <imageobject>
                    <imagedata fileref="./figures/score-bug/energy-most-xy.png" />
                  </imageobject>
                  <textobject><phrase>Scatterplot of error in energy use
                  (in SAP mode) due to latitude error, for EHS 2012
                  stock. This figure is restricted to houses with energy
                  use below 200,000 kWh/year, for
                  clarity.</phrase></textobject>
                </mediaobject>
              </figure>
              <figure>
                <title>Scatterplot of error in energy use (in SAP mode)
                due to latitude error, for EHS 2012 stock.</title>
                <mediaobject>
                  <imageobject>
                    <imagedata fileref="./figures/score-bug/energy-all-xy.png" />
                  </imageobject>
                  <textobject><phrase>Scatterplot of error in energy use
                  (in SAP mode) due to latitude error, for EHS 2012
                  stock.</phrase></textobject>
                </mediaobject>
              </figure>
            </listitem>
            <listitem>
              <para>
                A mis-reading of SAP table 5a caused the gains from
                central heating circulating pumps to be included when
                central heating is connected to a community heating
                system. However, table 5a states that they should be
                excluded in this case (although the electricity demand
                should not).
              </para>
              <para>
                This error has been corrected. It caused buildings with
                community heat connected to central heating to
                experience at most 87kWh/year more internal gains than
                they ought to have done, which will have reduced space
                heat demand by (at most) the same amount.
              </para>
              <para>
                The error affected 465 cases in the combined 2014 stock,
                for which the maximum change in annual energy use in SAP
                2012 mode was 59kWh/year. Most (22933) cases were
                unaffected.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Addition of energy calculator intermediate outputs
              </para>
              <para>
                Added
                <xref linkend="ref.house.energy-calculation-step"/>, a
                number function which allow you to look at intermediate
                steps in the energy calculation.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of SAP2012 Physical Mode
              </para>
              <para>
                A new energy calculator mode,
                <literal>SAP2012_PHYSICAL</literal> has been added. This
                is a slightly constrained version of
                <literal>BREDEM2012</literal>, which does not require
                specification of u-values or other physical parameters,
                but does allow changes outside the scope of
                <literal>SAP2012</literal>.
              </para>
              <para>
                It is documented in more detail below in the section on
                energy calculator modes.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of
                <xref linkend="ref.house.heating-system-output"/>
              </para>
              <para>
                This functions allows you to ask the model for the heat
                output from the heating system.
              </para>
            </listitem>
            <listitem>
              <para>
                Changes to lighting model and measures
              </para>
              <para>
                The way lights are represented in the stock has been
                changed to support products policy modelling. The stock
                data now records information about the type of lights
                that are installed in a house, rather than their
                efficiencies. The model represents six types of light:
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    Incandescent
                  </para>
                </listitem>
                <listitem>
                  <para>
                    CFL
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Halogen
                  </para>
                </listitem>
                <listitem>
                  <para>
                    LED
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Low-voltage Halogen
                  </para>
                </listitem>
                <listitem>
                  <para>
                    A++
                  </para>
                </listitem>
              </itemizedlist>
              <para>
                The efficiencies used for lights are determined by the
                energy calculator mode in use.
              </para>
              <para>
                The measures
                <xref linkend="ref.measure.replace-lighting"/> and
                <xref linkend="ref.measure.set-lighting-proportions"/>
                allow the installation of new lighting or a direct
                change to the lighting mix in a house, and
                <xref linkend="ref.house.lighting-proportion"/> allows
                you to query what proportion of the lights in a house
                are of a pariticular type.
              </para>
              <para>
                These changes have broken backwards-compatibility for
                lighting related commands, so you will need to amend any
                scenarios you have written which used
                <xref linkend="ref.measure.low-energy-lighting"/> or
                <xref linkend="ref.house.lighting-proportion"/> to
                refer to light types rather than light efficiencies.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of BEIS mode
              </para>
              <para>
                A new energy calculator mode, <literal>BEIS</literal>
                has been added. This is to support changes for products
                policy modelling. It has a more realistic set of
                lighting efficiency coefficients, and allows products
                policy changes to appliance and cooker efficiencies.
              </para>
              <para>
                It is documented in more detail below in the section on
                energy calculator modes.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Improvements
          </para>
          <itemizedlist>
            <listitem>
              <para>
                The service type for space heating has been subdivided
                into primary and secondary space heating. This means it
                is now possible to separately query energy use and
                emissions due to each heating system.
              </para>
            </listitem>
            <listitem>
              <para>
                The documentation for
                <xref linkend="ref.house.heat-load"/> has been improved
                to properly state that the heat load is determined
                before accounting for gains.
              </para>
            </listitem>
            <listitem>
              <para>
                The function <xref linkend="ref.house.heating-fuel"/>
                can now be used to ask about the heating fuel for
                secondary heating and hot water systems. Its behaviour
                has been changed to be more consistent with how the
                model works when there is no working main heating
                system;
              </para>
              <para>
                In this situation, the model assumes plug-in electric
                space heaters for the primary heating system (per SAP
                rules). When this is the case,
                <xref linkend="ref.house.heating-fuel"/> will output
                <literal>Electricity</literal>; previously it would
                output the heating fuel for the secondary space heating
                system, even though this heating system would not be
                used to meet most heat demand.
              </para>
            </listitem>
            <listitem>
              <para>
                In an associated change, the command
                <xref linkend="ref.house.main-heating-system-type"/>
                now outputs <literal>AssumedElectricHeater</literal>
                when primary space heating is handled by plug-in
                electric heaters.
              </para>
            </listitem>
            <listitem>
              <para>
                Energy calculator modes have been documented in more
                detail - see the next section of the manual if you are
                interested.
              </para>
            </listitem>
            <listitem>
              <para>
                There is now a checkbox in the application's editor
                preferences to disable auto-indentation, in case you
                don't want it.
              </para>
            </listitem>
            <listitem>
              <para>
                Added extra <literal>record-changes</literal> property
                on <xref linkend="ref.def-report"/>. If you set it to
                &quot;false&quot;, then you won't get the
                &quot;After&quot; columns in the report.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-7.1.0">
      <title>Version 7.1.0</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>
                Suitability for
                <xref linkend="ref.measure.solar-photovoltaic"/> is
                checked correctly. The implementation of measure
                suitability has been enhanced so this kind of error
                cannot be reintroduced for any other measure.
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.measure.warm-air-system"/> no longer
                ignores fuel argument.
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.measure.hot-water-tank-thermostat"/>
                checks for presence of water tank before installation.
              </para>
            </listitem>
            <listitem>
              <para>
                Fixed a problem where adding two extra fuel charges for
                the same fuel would give two duplicate charges instead.
              </para>
            </listitem>
            <listitem>
              <para>
                Fixed a problem with transferring money between a
                dwelling and a global account where it would multiply
                the amount byt the scenario quantum instead of the
                weight of the particular dwelling. This affects
                <xref linkend="ref.report.global-transactions"/> and
                <xref linkend="ref.account.balance"/>
              </para>
            </listitem>
            <listitem>
              <para>
                Basement floors are now treated as if they are ground
                floors for heat loss, per SAP 2012 S3.10
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.measure.low-energy-lighting"/> had
                no effect on buildings which had no low energy lighting
                to start with. It now works correctly for all buildings.
              </para>
            </listitem>
            <listitem>
              <para>
                In SAP mode, floor u-values for exposed upper floors did
                not account for the presence of floor insulation. This
                is fixed. The impact of the change is small, because
                there are few cases in the stock which have any exposed
                upper floor area. Only buildings in which storeys above
                the ground floor are larger than the storey below them
                which also have floor insulation will see an impact, and
                for these only for the heat loss contribution from the
                exposed floor area.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
            Improvements
          </para>
          <orderedlist>
            <listitem>
              <para>
                General
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    More information given when the desktop application
                    fails to retrieve reports from a remote server for a
                    simulation job
                  </para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>
                Documentation
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    Improved documentation for using consume function
                    <xref linkend="ref.consume"/> Added a note about
                    needing to take into account
                    <xref linkend="ref.house.weight"/> if using this.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Documentation for room heater unsuitability
                    <xref linkend="ref.measure.room-heater"/>
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Improved suitability information for hot water tank
                    thermostat measure
                    <xref linkend="ref.measure.hot-water-tank-thermostat"/>
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Improved suitability information for
                    <xref linkend="ref.measure.warm-air-system"/>
                  </para>
                </listitem>
              </itemizedlist>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-7.0.6">
      <title>Version 7.0.6</title>
      <para>
        This is a point release to fix a couple of omissions in 7.0.5.
      </para>
      <orderedlist>
        <listitem>
          <para>
            Bugs fixed
          </para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>
                The suitability constraints for
                <xref linkend="ref.measure.heating-control"/> have been
                amended:
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    Warm air systems are now suitable for having a
                    programmer added.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    Community heating systems are not suitable for
                    time-temperature-zone controls or delayed start
                    thermostats.
                  </para>
                </listitem>
              </itemizedlist>
              <para>
                The documentation for heating controls suitability has
                also been improved.
              </para>
            </listitem>
            <listitem>
              <para>
                The <xref linkend="ref.house.has-heating-control"/>
                command now tests for appliance thermostat on both
                primary and secondary heating, rather than just primary
                heating.
              </para>
            </listitem>
            <listitem>
              <para>
                The value for <xref linkend="ref.house.permeability"/>
                was being output incorrectly (it was 365 times too big).
                The error was in the production of annual outputs from
                monthly values within the energy calculation.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-7.0.5">
      <title>Version 7.0.5</title>
      <orderedlist>
        <listitem>
          <para>
            Improvements
          </para>
          <orderedlist>
            <listitem>
              <para>
                Change to calculation of
                <xref linkend="ref.house.permeability"/>
              </para>
              <para>
                The function can now specify whether to include or
                exclude deliberate ventilation from the airChange rate
                calculation.
              </para>
            </listitem>
            <listitem>
              <para>
                Change to calculation of
                <xref linkend="ref.house.sit"/>
              </para>
              <para>
                Calculation now defines heatloss as specific heat loss +
                ventilation heat loss rather than just specific heatloss
                as before.
              </para>
            </listitem>
            <listitem>
              <para>
                To u-values and inputs to measure
                <xref linkend="ref.measure.install-glazing"/>
              </para>
              <para>
                Added in the ability to specify an air-gap for the
                measure. Look-up tables for U-Values now take into
                account air-gap when returning u-values for glazings. If
                no u-value is supplied then u-value will be take from
                SAP tables.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Added new function
                <xref linkend="ref.house.has-solar-thermal"/>
              </para>
              <para>
                Returns true of the central hot water heating system
                includes a solar thermal component
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="verison-7.0.3">
      <title>Verison 7.0.3</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Reverted macro validation fixes added as they cause
                errors which affect previous BEIS scenarios
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-7.0.2">
      <title>Version 7.0.2</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                House Permeability Calculation
              </para>
              <para>
                Calculate house envelope using all surfaces not just
                external - Asked for by BEIS/Hideem team
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-7.0.1">
      <title>Version 7.0.1</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Combinations.choice - now expands combinations to actual
                measure classes rather than nulls - caused by a bad code
                merge
              </para>
            </listitem>
            <listitem>
              <para>
                Suggestions and help for macros
              </para>
              <para>
                The desktop application now includes suggestions and
                help for macro arguments which are not optional. These
                arguments were previously being left out, by mistake.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-7.0.0">
      <title>Version 7.0.0</title>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Combinations Choice
              </para>
              <para>
                To help with performance issues being created by using
                the ~combinations macro within templates combinations
                choice has been added to avoid the need to macro expand
                the scenario before validation. This expansion now
                happens when executing the simulaiton see
                <xref linkend="ref.combination.choice"/>.
              </para>
            </listitem>
            <listitem>
              <para>
                Products Modelling
              </para>
              <para>
                To enable modelling of some products policy changes to
                the NHM some new scenario language elements have been
                added.
              </para>
              <para>
                For modelling of changes to energy used by appliances
                and cooking the
                <xref linkend="ref.measure.set-adjustment-terms"/>
                function allows you to apply a linear correction factor
                to the energy use of appliances or overaching energy use
                coooking with reference to SAP2012 L10.
              </para>
              <para>
                For modelling the altertion of lighting elements within
                a house <xref linkend="ref.measure.lighting"/> has been
                added to alter the types of light within a house and
                <xref linkend="ref.house.lighting-proportion"/> has
                been added to allow reporting on this.
              </para>
            </listitem>
            <listitem>
              <para>
                Health modelling
              </para>
              <para>
                The health impact calculations from UCL and LSHTM's
                HIDEEM model have been integrated into the NHM.
              </para>
              <para>
                The <xref linkend="ref.health-impact-of"/> function
                allows you to compute the health impact in terms of
                morbidity QALYS, mortality QALYS, or avoided NHS costs
                which result from a given change in internal temperature
                or fabric permeability as a result of a measure being
                applied.
              </para>
              <para>
                Some supporting functions have been added to calculating
                the inputs to <xref linkend="ref.health-impact-of"/>.
              </para>
              <para>
                <xref linkend="ref.house.permeability"/> represents the
                permeability of the house (air change rate / area).
              </para>
              <para>
                <xref linkend="ref.house.sit"/> and
                <xref linkend="ref.house.sit-rebate"/> predict a
                realistic internal temperature in a house.
              </para>
            </listitem>
            <listitem>
              <para>
                house.surface-area
              </para>
              <para>
                A function <xref linkend="ref.house.surface-area"/> has
                been added, this returns the area of the external
                envelope of the dwelling (roof, floor, walls, windows
                and doors).
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.5.5">
      <title>Version 6.5.5</title>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <para>
            Put back the <emphasis>desired-heat-months</emphasis>
            property on
            <xref linkend="ref.action.set-heating-temperatures"/>.
          </para>
          <para>
            This was removed in the SAP 2012 update.
          </para>
          <para>
            This property has different behaviour to before. It now
            explcitly sets which months the heating will be on for. It
            has no effect in SAP2012 mode.
          </para>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.5.4">
      <title>Version 6.5.4</title>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Heat loss roofs and ground floors for flats
              </para>
              <para>
                If a flat has a storey which is the top floor of its
                building, then it has a heat loss roof. Similarly, its
                bottom storey is the bottom floor of its building (in
                the EHS, it is either the basement or ground floor), it
                will have a heat loss floor.
              </para>
              <para>
                The measure suitability for
                <xref linkend="ref.measure.loft-insulation"/>,
                <xref linkend="ref.measure.solar-dhw"/> and
                <xref linkend="ref.measure.solar-photovoltaic"/> now
                admits flats if and only if they have a heat loss roof.
                The measure suitability for
                <xref linkend="ref.measure.floor-insulation"/> now
                admits flats if and only if they have a heat loss floor.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                U-value calculation for suspended timber ground floors
              </para>
              <para>
                This has changed from SAP 2009 to SAP 2012. It seems
                likely that the SAP 2009 version was a mistake.
              </para>
              <para>
                In SAP 2009: set Rf to 0.2, then compute
                <literal>Rf + 0.2</literal>.
              </para>
              <para>
                In SAP 2012: compute Rf based on floor insulation
                thickness, then compute <literal>Rf + 0.2</literal>.
              </para>
              <para>
                We now implement the SAP 2012 version.
              </para>
            </listitem>
            <listitem>
              <para>
                Stock import of solid floors
              </para>
              <para>
                Version 6.5.0 introduced a bug where Solid floors were
                being reclassified as SuspendedTimber. This is now
                fixed.
              </para>
            </listitem>
            <listitem>
              <para>
                Infiltrations when resetting walls.
              </para>
              <para>
                The <emphasis>infiltrations</emphasis> property in
                <xref linkend="ref.action.reset-walls"/> has been
                broken since v6.5.0. It was setting air change rate to
                0.
              </para>
              <para>
                This is now working correctly again.
              </para>
            </listitem>
            <listitem>
              <para>
                Bug in <xref linkend="ref.affected-houses"/>
              </para>
              <para>
                The <xref linkend="ref.affected-houses"/> command would
                not work correctly if used as the source group for a
                <xref linkend="ref.filter"/> in more than one place
                within a single use of the
                <literal>on.construction</literal> command.
              </para>
              <para>
                Each <xref linkend="ref.filter"/> applied would have a
                cumulative effect on the contents of the next use of
                <xref linkend="ref.affected-houses"/>.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Improvements
          </para>
          <para>
            The manual embedded in the desktop application has had
            additional indexing information added to it, which improves
            the specificity of searches for model commands.
          </para>
          <para>
            In addition, by reading the manual for the help facility, we
            have learned that enclosing search queries in double quotes
            <literal>&quot;like this&quot;</literal> searches for the
            literal occurrence of the text in quotes, rather than the
            occurrence of all the separate words typed in.
          </para>
          <para>
            Taken together these changes mean that when searching for
            model commands like <literal>house.energy-use</literal>,
            entering <literal>&quot;house.energy-use&quot;</literal>
            into the help will produce much better specificity of
            results.
          </para>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.5.3">
      <title>Version 6.5.3</title>
      <para>
        We don't know where this version number went.
      </para>
    </section>
    <section xml:id="version-6.5.2">
      <title>Version 6.5.2</title>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Inclusion of a test for wall thickness
              </para>
              <para>
                Per support ticket number 83
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.5.1">
      <title>Version 6.5.1</title>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Roof Area Function
              </para>
              <para>
                Added <xref linkend="ref.house.roof-area"/> to allow
                you to look at the roof area of a dwelling. This is
                useful when installing a solar PV measure.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Wall Thickness
              </para>
              <para>
                Wall thickness was not getting set in the stock import.
                This resulted in incorrect u-values for old solid-wall
                buildings.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.5.0">
      <title>Version 6.5.0</title>
      <para>
        This version of the NHM has been updated to support SAP 2012
        (closely, with the scenario author prevented from putting in
        their own override values) and BREDEM 2012 (more loosely).
      </para>
      <para>
        This changelog primarily covers scenario language changes. For a
        more in-depth discussion of the energy calculator update, see
        ref.sap-2012-spec.
      </para>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                BREDEM Specific Configuration
              </para>
              <para>
                The following three actions allow you to change some
                BREDEM-specific features of a house. They have no effect
                in SAP 2012 mode.
              </para>
              <para>
                <xref linkend="ref.action.set-site-exposure"/> puts a
                house in an exposure category. This maps to a multiplier
                to its infiltration rate.
              </para>
              <para>
                <xref linkend="ref.action.set-interzone-specific-heat-transfer"/>
                sets the rate of heat transfer from the main living area
                of the house to the rest of the house.
              </para>
              <para>
                <xref linkend="ref.action.reduced-internal-gains"/>
                enables reduced internal gains for that house. This is
                supposed to apply to modern houses.
              </para>
              <para>
                <xref linkend="ref.action.set-thermal-bridging-factor"/>
                is multiplied by the external area of the ddwelling to
                calculate the thermal bridging heat loss rate.
              </para>
            </listitem>
            <listitem>
              <para>
                Switch Energy Calculator Modes
              </para>
              <para>
                The <xref linkend="ref.scenario"/> element now has an
                <emphasis>energy-calculator:</emphasis> property. This
                can take the values <emphasis>SAP2012</emphasis> or
                <emphasis>BREDEM2012</emphasis>, and determines which
                rules will apply for this scenario.
              </para>
              <para>
                There is a new counterfactual action
                <xref linkend="ref.energy-calculator"/>, which allows
                you to temporarily look at a house in a different energy
                calculator mode.
              </para>
            </listitem>
            <listitem>
              <para>
                Heat Loss Intermediate Calculations
              </para>
              <para>
                <xref linkend="ref.house.heat-loss"/> has now has an
                optional (unnamed) parameter which allows you to look at
                specific heat-loss due to
                <emphasis>ThermalBridging</emphasis>,
                <emphasis>Infiltration</emphasis> or
                <emphasis>Fabric</emphasis>.
              </para>
              <para>
                If you do not specify this parameter, the behaviour will
                be unchanged from previous releases. You will get the
                total specific heat loss, which is the three terms above
                added together.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Removed Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Solar PV
              </para>
              <para>
                We have removed <emphasis>roof-coverage</emphasis> and
                <emphasis>efficiency</emphasis> from
                <xref linkend="ref.measure.solar-photovoltaic"/>, and
                replaced them with <emphasis>size</emphasis>, which is
                the peak power rating of the installation measured in
                kW.
              </para>
            </listitem>
            <listitem>
              <para>
                Responsiveness
              </para>
              <para>
                The <literal>scale.responsiveness</literal> action has
                been removed. With hindsight, it was a bad feature, and
                we do not believe it has ever been used.
              </para>
              <para>
                Removed the <emphasis>of:</emphasis> property from
                <xref linkend="ref.house.heating-responsiveness"/>,
                since only the responsiveness of the primary space
                heating system is always relevant.
              </para>
            </listitem>
            <listitem>
              <para>
                Thermal Mass
              </para>
              <para>
                The NHM now uses a simplified method for calculating the
                thermal mass of a dwelling.
              </para>
              <para>
                <literal>wall.k-value</literal> has been removed.
              </para>
              <para>
                <xref linkend="ref.action.reset-floors"/>,
                <xref linkend="ref.action.reset-walls"/> and
                <xref linkend="ref.action.reset-roofs"/> have had their
                <emphasis>k-value</emphasis> and
                <emphasis>party-k-value</emphasis> properties removed.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Semantic Changes
          </para>
          <para>
            A number of actions in the NHM are designed for tweaking
            values from SAP tables. In SAP 2012 mode, they will no
            longer have any effect:
          </para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>
                <xref linkend="ref.action.reset-floors"/>
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.action.reset-roofs"/>
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.action.reset-doors"/>
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.action.reset-glazing"/>
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.action.reset-walls"/>
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.action.set-heating-schedule"/>
              </para>
            </listitem>
            <listitem>
              <para>
                <xref linkend="ref.action.set-heating-temperatures"/>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.4.0">
      <title>Version 6.4.0</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Flags and reports work on def-action
              </para>
              <para>
                If an action was used at the top level of a
                <xref linkend="ref.def-action"/> command with the
                <literal>update-flags:</literal>,
                <literal>test-flags:</literal> or
                <literal>report:</literal> keyword arguments, and
                referred to in two places within the scenario, the later
                references would not update or test flags, or perform
                reporting.
              </para>
            </listitem>
            <listitem>
              <para>
                Mistake with hypotheses
              </para>
              <para>
                In certain fairly rare conditions, the
                <literal>rise-in</literal>, <literal>fall-in</literal>
                and <literal>original</literal> functions would return
                the wrong result when evaluated within a hypothetical
                situation. This has been remedied.
              </para>
            </listitem>
            <listitem>
              <para>
                Improvements to the manual
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    The heating control measure suitability has been
                    changed to be (hopefully) more readable
                  </para>
                </listitem>
                <listitem>
                  <para>
                    The documentation for
                    <xref linkend="ref.house.annual-cost"/> has been
                    changed to be more descriptive.
                  </para>
                </listitem>
              </itemizedlist>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            New features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Multiple stocks
              </para>
              <para>
                You can now specify multiple stocks in a scenario by
                supplying a list of values to the scenario's
                <literal>stock-id:</literal> argument; for example
                writing <literal>stock-id: [a b c]</literal> will use
                all the houses from stocks <literal>a</literal>,
                <literal>b</literal>, and <literal>c</literal> together.
                This does not affect old scenarios with a single stock,
                but should make it easier to work with stocks for
                multiple countries.
              </para>
            </listitem>
            <listitem>
              <para>
                Automatic use of <literal>filter</literal>
              </para>
              <para>
                It is now possible to write logical tests in any place
                where you would write a group of houses. The logical
                test will have an &quot;implicit&quot;
                <xref linkend="ref.filter"/> command added to it, so
                where you would previously have written
                <literal>(filter (X))</literal> you may now write just
                <literal>(X)</literal>. Note that to use
                <literal>filter</literal>'s second argument (a specific
                set to filter, rather than the whole population) you
                will still have to write it out in full.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of <literal>fail-unless</literal>
              </para>
              <para>
                The <xref linkend="ref.fail-unless"/> command has been
                added, to make a common pattern easier to write.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.3.2">
      <title>Version 6.3.2</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Batch reports work properly in the desktop application
              </para>
              <para>
                A mistake whereby only the last year's output for
                reports from each part of a batch run was present in the
                output in the desktop version of the NHM has been fixed.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.3.1">
      <title>Version 6.3.1</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Summer Boiler Efficiencies
              </para>
              <para>
                Changed the default summer boiler efficiency to -10%
                (10% less than the winter efficiency) based on a
                re-analysis of the Product Characteristics Database 2009
                (PCDB).
              </para>
              <para>
                Added a note to the manual to explain when this number
                is and is not likely to be accurate.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Choose how to weight your stock.
              </para>
              <para>
                <xref linkend="ref.scenario"/> now has a field
                <emphasis>weight-by:</emphasis> which accepts any
                number, or any function of a house which produces a
                number.
              </para>
              <para>
                The intention is that you could use
                <xref linkend="ref.house.static-number"/> here to
                weight based on the household weight instead.
              </para>
              <para>
                The default value for the
                <emphasis>weight-by:</emphasis> field is
                <literal>weight-by: (house.weight)</literal>. This
                weights by the survey's dwelling case weight, so this
                feature will not change the behaviour of any existing
                scenarios.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Semantic Changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Stock weights are now decimals
              </para>
              <para>
                Previously, you could input the dwelling case weight and
                household case weight in the stock as decimals, but they
                would be rounded to integers before use.
              </para>
              <para>
                We have removed this rounding step.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.3.0">
      <title>Version 6.3.0</title>
      <para>
        These are fixes relating to
        <link xlink:href="https://cseresearch.atlassian.net/browse/EXS-108">EXS-108</link>.
      </para>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Space heating systems used the total hot water fraction
              </para>
              <para>
                Space heating systems were incorrectly calculating their
                share of the space heating output by comparing their
                space heating fraction to the total hot water fraction
                (summed over all sources of hot water). This bug has now
                been fixed.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Obsolete Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Point-of-use-hot-water
              </para>
              <para>
                <xref linkend="ref.measure.point-of-use-hot-water"/> is
                now obsolete. This measure was used as a backup water
                heater when a dwelling's boiler was broken. This backup
                behaviour now happens automatically as specified by SAP,
                so the measure is no longer useful.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Semantic Changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Space heating fraction is now derived
              </para>
              <para>
                The space heating fractions are now derived according to
                SAP 2009 when you run the energy calculator. The
                following rules apply:
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    If a primary heater is present, calculate the
                    secondary heating fraction based on the primary
                    heater, as per SAP table 11.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    If no primary heater is present, assume 10% of the
                    heat will be generated by secondary heaters
                    (&quot;Other electric heaters in SAP table
                    11&quot;). Produce the other 90% from assumed
                    portable electric heaters.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    If no secondary heater is present, but the primary
                    heater is a storage heater, then secondary heating
                    is <emphasis role="strong">required</emphasis>.
                    Assume the portable electric heaters are the
                    secondary heater.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    If no secondary heater is present, generate the
                    remaining heat from the primary heater.
                  </para>
                </listitem>
              </itemizedlist>
              <para>
                Note that, for heat-pumps, we use the <emphasis>Heat
                pump, data from Table 4a</emphasis> entry of Table 11
                (10% of heat produced by secondary system). This is
                because the model does not have the data required to
                implement the lookups in Appendix N.
              </para>
            </listitem>
            <listitem>
              <para>
                Removed concept of water heating fraction
              </para>
              <para>
                SAP 2009 does not have a concept of a water heating
                fraction. All the hot water should be produced by the
                primary system if present, or the secondary system if
                the primary is missing, or by assumed electric heaters
                if no water heaters at all are present. This is now
                correctly implemented.
              </para>
            </listitem>
            <listitem>
              <para>
                Automatic behaviour when breaking the boiler
              </para>
              <para>
                <xref linkend="ref.measure.break-boiler"/> no longer
                includes the properties <emphasis>room-heater</emphasis>
                and <emphasis>water-heater</emphasis>. Portable electric
                heaters will now automatically be used as backups for
                missing heating systems as specified by SAP 2009.
              </para>
            </listitem>
            <listitem>
              <para>
                Removed backup property from room heaters
              </para>
              <para>
                <xref linkend="ref.measure.room-heater"/> no longer has
                a <emphasis>backup</emphasis> property. This property is
                no longer useful as we are automatically using portable
                electric heaters as backup heaters. Existing scenario
                which use <emphasis>backup</emphasis> will need to be
                amended to remove it.
              </para>
            </listitem>
            <listitem>
              <para>
                Removed scale.efficiency
              </para>
              <para>
                <literal>scale.efficiency</literal> has been removed
                from the language. We decided that it was redundant -
                you can easily create a template which does the same
                with other language pieces. Additionally, its behaviour
                was confusing when applied to homes with boilers, as
                they have two efficiency numbers (winter and summer).
              </para>
            </listitem>
            <listitem>
              <para>
                Explicit winter and summer efficiency for boilers
              </para>
              <para>
                <xref linkend="ref.measure.standard-boiler"/> and
                <xref linkend="ref.measure.combi-boiler"/> no longer
                have a <emphasis>efficiency</emphasis> property. This
                has been replace with two properties
                <emphasis>winter-efficiency</emphasis> and
                <emphasis>summer-efficiency</emphasis>. These may be set
                as a proportion.
              </para>
              <para>
                There is an additional option for
                <emphasis>summer-efficiency</emphasis>: it may be
                specified as 0 or a negative number. In this case, our
                actual summer efficiency will be that much lower than
                <emphasis>winter-efficiency</emphasis> value.
              </para>
              <para>
                The default value for
                <emphasis>winter-efficiency</emphasis> is the same as
                the previous default value for
                <emphasis>efficiency</emphasis>.
              </para>
              <para>
                The default value for
                <emphasis>summer-efficiency</emphasis> is -1%. (That is,
                1% lower than winter efficiency). This is based on a
                linear regression against the 2009 Product
                Characteristics Database (PCDB) data, which found this
                relationship to be true for almost all boilers in that
                dataset.
              </para>
            </listitem>
            <listitem>
              <para>
                Renamed measure.change-boiler-efficiency
              </para>
              <para>
                <literal>measure.change-boiler-efficiency</literal> has
                been renamed to
                <xref linkend="ref.action.change-efficiency"/>. It's
                <emphasis>to</emphasis> argument has been removed and
                replaced with <emphasis>winter-efficiency</emphasis> and
                <emphasis>summer-efficiency</emphasis>, which behave in
                a similar way as described above for installing boilers.
              </para>
              <para>
                One of <emphasis>winter-efficiency</emphasis> or
                <emphasis>summer-efficiency</emphasis> may be left unset
                for this action, in which case the existing value will
                be kept.
              </para>
              <para>
                <emphasis>winter-efficiency</emphasis> is also used as
                the main efficiency for other types of heaters than
                boilers (and as COP for heat pumps).
              </para>
              <para>
                <emphasis>summer-efficiency</emphasis> is ignored for
                heaters which are not boilers.
              </para>
            </listitem>
            <listitem>
              <para>
                house.heating-efficiency changes
              </para>
              <para>
                <xref linkend="ref.house.heating-efficiency"/> now has
                an additional property <emphasis>measurement</emphasis>.
              </para>
              <para>
                This can take one of three values:
                <emphasis>Winter</emphasis>, <emphasis>Summer</emphasis>
                and <emphasis>InSitu</emphasis>.
              </para>
              <para>
                Winter and Summer return the relevant seasonal
                efficiencies for boilers, and are identical to the
                previous behaviour of house.heating-efficiency for other
                kinds of heat sources.
              </para>
              <para>
                InSitu calculates an effective efficiency for the
                heating system by taking the amount of heat it supplied
                and dividing it by the amount of fuel it used. This is
                useful if you want to get an idea of the effects of
                SAP's internals.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.2.2-8th-october-2015">
      <title>Version 6.2.2 [8th October 2015]</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                house.all-walls matched all houses
              </para>
              <para>
                A mistake in the code for
                <xref linkend="ref.house.all-walls"/> caused it to be
                true in all cases. This bug has now been removed.
              </para>
            </listitem>
            <listitem>
              <para>
                house.sum-transactions case-sensitivity
              </para>
              <para>
                The <xref linkend="ref.house.sum-transactions"/>
                function was unable to restrict the transactions summed
                using transactions whose tags included capital letters.
                This made it impossible to sum capital cost
                transactions, as they are tagged
                <literal>:CAPEX</literal>; behind-the-scenes this was
                caused by the automatic lowercasing of all user-entered
                flags and tags, but a lack of lowercasing of the
                built-in tags.
              </para>
              <para>
                This has been fixed so that the transaction matching is
                consistent with all other tag matching (it is
                case-insensitive).
              </para>
            </listitem>
            <listitem>
              <para>
                Transaction tags reference includes capex
              </para>
              <para>
                The automatically generated list of all default
                transaction tags accidentally omitted the
                <literal>:CAPEX</literal> tag; that tag should now be in
                the list.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            New features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Improvement to <literal>select.weighted</literal>
              </para>
              <para>
                The documentation to
                <xref linkend="ref.select.weighted"/> has been improved
                in response to user feedback, and the weight function
                can now be specified as the first argument without
                having to use the superfluous <literal>weight:</literal>
                keyword.
              </para>
            </listitem>
            <listitem>
              <para>
                Easier date specification
              </para>
              <para>
                As many of the dates written in scenarios are annual,
                you can now write years instead of full dates to
                indicate the first of January; for example,
                <literal>01/01/2014</literal> can now be written simply
                as <literal>2014</literal>.
              </para>
              <para>
                In addition, annual date ranges which previously were
                written as 'regularly' can now be written as two literal
                dates with two dots between them. For example
                <literal>01/01/2014..01/01/2020</literal> is equivalent
                to
                <literal>(regularly from:01/01/2014 until:01/01/2020)</literal>.
                This also admits the above shorthand, so you can write
                <literal>2014..2020</literal>.
              </para>
            </listitem>
            <listitem>
              <para>
                Improvement to
                <xref linkend="ref.house.sum-transactions"/>,
                <xref linkend="ref.net-cost"/>,
                <xref linkend="ref.predict-obligations"/> and other
                transaction-related functions
              </para>
              <para>
                All functions which match transactions can now specify a
                list of required and forbidden tags using patterns,
                which work in the same way as the
                <literal>test-flags:</literal> argument on measures.
                This should simplify the production of aggregate
                information.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Semantic changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Changes to built-in tags
              </para>
              <para>
                In previous versions, all built-in transaction tags
                started with a colon, like <literal>:CAPEX</literal>,
                <literal>:subsidy</literal> and so on. All of these tags
                are still produced, but additional tags are also added
                which don't start with a colon, like
                <literal>CAPEX</literal> and <literal>subsidy</literal>.
                This makes it easier to write commands which match these
                tags.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.2.1-not-published">
      <title>Version 6.2.1 [Not published]</title>
      <orderedlist>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Stock import not using draught stripped proportion
              </para>
              <para>
                A mistake in the DTO importing code caused the draught
                stripped proportion field to be ignored, leaving
                dwellings in the stock with a draught stripped
                proportion of 0 (the default if unspecified). This bug
                has been fixed, but will only affect newly imported
                stocks.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.2.0-not-published">
      <title>Version 6.2.0 [Not published]</title>
      <para>
        This version was not published, and only exists for technical
        reasons of little interest.
      </para>
      <orderedlist>
        <listitem>
          <para>
            New features
          </para>
          <orderedlist>
            <listitem>
              <para>
                More useful handling of <literal>Electricity</literal>
                as a fuel
              </para>
              <para>
                The <literal>Electricity</literal> fuel type is normally
                only used in the model to describe what kind of heating
                system you want to put in, or what the heating fuel of a
                house is. Energy use is broken down into
                <literal>PeakElectricity</literal> and
                <literal>OffPeakElectricity</literal>, and the
                <literal>Electricity</literal> consumed is internally
                always zero (to prevent double-counting).
              </para>
              <para>
                In response to DECC request EXS-64, the definition for
                <xref linkend="ref.house.energy-use"/>,
                <xref linkend="ref.house.fuel-cost"/> and
                <xref linkend="ref.house.emissions"/> have been amended
                to treat the argument
                <literal>by-fuel: Electricity</literal> as a special
                case, which will always compute the sum of the values
                that would be produced if you used
                <literal>by-fuel:PeakElectricity</literal> and
                <literal>by-fuel:OffPeakElectricity</literal>.
              </para>
              <para>
                The behaviour of these terms and the rest of the model
                is unchanged in all cases except when
                <literal>by-fuel: Electricity</literal> is supplied, so
                (for example) you will still want to supply separate
                peak and off-peak prices in tariff definitions.
              </para>
              <para>
                This change was made to resolve JIRA ticket EXS64.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Semantic changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Change to <literal>Electricity</literal> handling in
                <xref linkend="ref.house.fuel-cost"/>,
                <xref linkend="ref.house.energy-use"/> and
                <xref linkend="ref.house.emissions"/>
              </para>
              <para>
                As mentioned in <emphasis>new features</emphasis> above,
                these functions now behave differently if you use them
                with the argument
                <literal>by-fuel:Electricity</literal>. Previously
                <literal>house.energy-use</literal> and
                <literal>house.emissions</literal> would always return
                zero, and <literal>house.fuel-cost</literal>
                <emphasis>could</emphasis> produce a value, but only for
                strangely defined tariffs. These functions will now
                compute the sum of the values for
                <literal>PeakElectricity</literal> and
                <literal>OffPeakElectricity</literal> instead.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.1.0-30th-july-2015">
      <title>Version 6.1.0 [30th July 2015]</title>
      <orderedlist>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Addition of <xref linkend="ref.house.flags"/> and
                extension of flag matching
              </para>
              <para>
                The <xref linkend="ref.house.flags"/> element has been
                added, which is useful in reports to output which flags
                from many possibilities are are on a house, rather than
                producing one column for each flag. This was added to
                make a scenario for the CCC easier to analyse.
              </para>
              <para>
                As part of this change, the rules for matching and
                adjusting flags have been extended (in a
                backwards-compatible way) to support more complicated
                pattern matching. To give some examples, you can now use
                <literal>test-flags: [something-*]</literal> to test
                whether a house has a flag starting with
                <literal>something-</literal>, or
                <literal>update-flags: [!something-* something-or-other]</literal>
                to remove all flags starting with
                <literal>something-</literal> and then add a flag
                <literal>something-or-other</literal>. More complicated
                patterns are supported; see the documentation for a flag
                related element for more details.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of
                <xref linkend="ref.house.has-solar-photovoltaic"/>
              </para>
              <para>
                You can now use
                <xref linkend="ref.house.has-solar-photovoltaic"/> to
                test whether a house has solar PV or not. This was added
                as a request from DECC central modelling.
              </para>
            </listitem>
            <listitem>
              <para>
                Improved performance for loans
              </para>
              <para>
                The model's performance when simulating many loans
                should now be faster, especially when loans have the
                <literal>tilt:</literal> parameter specified. This work
                was done whilst looking at a scenario which involved a
                lot of loans.
              </para>
            </listitem>
            <listitem>
              <para>
                Change to the handling of build year in stocks
              </para>
              <para>
                In response to JIRA request EXS-43 the way dwellings are
                created from stocks has been changed so that houses are
                constructed on their build year; this is the very first
                thing that happens in each year.
              </para>
              <para>
                To make this easier to use correctly in a scenario, the
                top-level <xref linkend="ref.on.construction"/> command
                allows you to schedule commands to be run whenever new
                dwellings are constructed.
              </para>
            </listitem>
            <listitem>
              <para>
                Amendment to <xref linkend="ref.summarize"/>
              </para>
              <para>
                The <xref linkend="ref.summarize"/> command now allows
                the set to summarize to be specified as the second
                unnamed argument, as well as using named argument
                <literal>group:</literal>. This change was made to
                improve consistency with other set-processing commands.
                The existing syntax remains compatible.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Semantic changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Change to the handling of build year in stocks
              </para>
              <para>
                Because cases from the stock now only appear in the
                simulation from the start of their build year onwards,
                old scenarios whose start date was earlier than the
                build date of some cases in a stock may produce
                different results, as previous anachronistic dwellings
                will no longer be present in the simulation. For
                example, if you were to run a scenario with start date
                1/1/0000 it would now typically have no houses at
                scenario start.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Bugs fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Error in <literal>repeat</literal> removed
              </para>
              <para>
                In previous versions the <xref linkend="ref.repeat"/>
                command would incorrectly preserve only the value of the
                first modified variable defined to be
                <literal>on:simulation</literal> when more than one such
                variable was used in the <literal>preserve:</literal>
                argument. The <literal>preserve:</literal> argument now
                works correctly.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-6.0.0-8th-june-2015">
      <title>Version 6.0.0 [8th June 2015]</title>
      <orderedlist>
        <listitem>
          <para>
            Semantic changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Change to random number generation
              </para>
              <para>
                Unfortunately the mechanism introduced to support
                repeatable use of random numbers within the
                <xref linkend="ref.scheduling.repeat"/> command in
                v5.1.4 also introduced some statistical artifacts in
                random numbers consumed within hypotheses that never
                become true. For example, if you were to use a uniform
                random number to perturb the objective in the
                <xref linkend="ref.in-order"/> command, it would not be
                as uniform as it should be. In this version those
                artifacts have been fixed, at the expense of consistency
                of randomness between the two versions.
              </para>
              <para>
                This issue was detected during the development of RHI
                scenarios.
              </para>
            </listitem>
            <listitem>
              <para>
                Stricter validation of <xref linkend="ref.lookup"/> and
                <literal>lookup-table</literal>
              </para>
              <para>
                In previous versions, you could define a
                <xref linkend="ref.lookup"/> or
                <literal>lookup-table</literal> which tried to match
                functions on values they would never produce (for
                example, checking whether a dwelling's region was
                <literal>MainsGas</literal> by mistake). From this
                version onward, the coordinates in lookups and lookup
                tables are validated against the possible values for the
                associated key function.
              </para>
              <para>
                This change was made in response to a mistake in an RHI
                policy scenario where the wrong key function was
                accidentally used, which caused unexpected behaviour in
                the scenario.
              </para>
            </listitem>
            <listitem>
              <para>
                Stricter validation of <xref linkend="ref.is"/>
              </para>
              <para>
                <xref linkend="ref.is"/> now produces validation
                warnings if some of the values to match are not possible
                outputs from the function being tested. For example, if
                you were to write
                <literal>(is house.heating-fuel MiansGas)</literal> (a
                typo), a validation error message will be produced which
                indicates that <literal>MiansGas</literal> is not a
                possible value for
                <literal>house.heating-fuel</literal>.
              </para>
              <para>
                This change was made because of confusion during the
                development of RHI scenarios caused by its lack.
              </para>
            </listitem>
            <listitem>
              <para>
                Defaults in
                <xref linkend="ref.context.carbon-factors"/>
              </para>
              <para>
                In previous versions of the model, the default carbon
                factors were taken from SAP 2009. If you specified new
                carbon factors using
                <xref linkend="ref.context.carbon-factors"/>, the
                defaults would be entirely replaced. For example,
                writing
              </para>
              <programlisting>
(context.carbon-factors
 (group fuels:PeakElectricity
        carbon-factor: 0.5))
</programlisting>
              <para>
                would set the <literal>PeakElectricity</literal> factor
                to 0.5, and all other factors to an implicit zero. This
                has been changed so that the default SAP 2009 carbon
                factors are retained unless a <literal>group</literal>
                in <xref linkend="ref.context.carbon-factors"/>
                replaces them.
              </para>
              <para>
                This change was made in response to some confusion
                caused in a scenario developed by the CCC.
              </para>
            </listitem>
            <listitem>
              <para>
                Restricted precision in efficiencies
              </para>
              <para>
                The precision with which efficiencies are represented
                has been restricted to 0.1% across the model.
              </para>
              <para>
                This change was needed to improve memory efficiency so
                as to make some complex scenarios developed for the RHI
                feasible to run.
              </para>
            </listitem>
            <listitem>
              <para>
                Reduced precision for energy use and carbon emissions
              </para>
              <para>
                The precision with which energy use and carbon emissions
                are represented has been reduced from a 64-bit IEEE 754
                floating point number to a 32-bit IEEE 754 floating
                point number. This should not have any practical impact,
                but it will produce very small changes in the values
                produced by existing scenarios for these quantities, and
                marginally reduce the precision with which they can be
                represented. However, the loss of precision will be far
                from the decimal point.
              </para>
              <para>
                This change was needed to improve memory efficiency so
                as to make some complex scenarios developed for the RHI
                feasible to run.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            New features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Hybrid Heat Pumps and Gas Heat Pumps
              </para>
              <para>
                The model's representation of heat pumps has been
                changed to allow non-electric heat pumps and hybrid heat
                pumps to be represented. Existing heat pumps in
                scenarios will still default to electricity, as these
                changes only take effect when the new parameters to
                <xref linkend="ref.measure.heat-pump"/> are supplied.
              </para>
              <para>
                The treatment of non-electric heat pumps is identical to
                electric heat pumps, except the fuel consumed is all of
                one sort (rather than being peak / off-peak). The
                <literal>fuel:</literal> argument to
                <literal>measure.heat-pump</literal> can be used to
                select a fuel.
              </para>
              <para>
                Hybrid heat pumps are represented in a manner suggested
                by the RHI team; three additional parameters are
                provided:
              </para>
              <orderedlist spacing="compact">
                <listitem>
                  <para>
                    <literal>hybrid-fuel:</literal>, which specifies the
                    fuel used by the burner in the hybrid part of the
                    heat pump,
                  </para>
                </listitem>
                <listitem>
                  <para>
                    <literal>hybrid-efficiency:</literal>, which is
                    computed to determine the efficiency of the hybrid
                    part of the heat pump, and
                  </para>
                </listitem>
                <listitem>
                  <para>
                    <literal>hybrid-ratio:</literal>, which is a list of
                    twelve numbers intended to be used to set the
                    heat-pump to hybrid burner output fraction in each
                    month of the year.
                  </para>
                </listitem>
              </orderedlist>
              <para>
                When a hybrid heat pump is installed, all hot water is
                produced using the hybrid fuel at the hybrid efficiency.
                In each month of the year, space heat is produced
                according to the hybrid ratio for that month (if the
                hybrid ratio is 1, all space heat is produced from the
                hybrid fuel at the hybrid efficiency; if 0, the space
                heat is produced using the heat pump as normal).
              </para>
              <para>
                This is in line with the indications given in
                <link linkend="http://www.daikin.co.uk/binaries/FINAL%20-%20Installer%20Brochure%20-%2010.02.2014_tcm511-305363.pdf">this
                documentation</link> about the Daikin Altherma hybrid
                heat pump.
              </para>
              <para>
                <emphasis>Users should note</emphasis> that this
                approach suffers from the same problems as using an
                average seasonal performance factor for a heat pump, but
                with some additional complications. The performance of a
                heat pump is determined by a (typically asymmetric,
                nonlinear) function of the circulating temperature and
                the heat store temperature. These two values are in turn
                functions of exterior temperature, emitter performance,
                the dwelling's heat loss, and thermostat settings. A
                choice of SPF, and equally of the monthly hybrid ratios,
                implies a choice of distribution over all of these
                factors which can then be used to produce an average
                performance; such an average performance will by
                systematically biased when the distribution over one of
                the factors changes (for example when considering the
                geographical relationship to climate). In addition,
                because a hybrid heat pump is likely to select fuel
                based on <emphasis>economic</emphasis> considerations,
                the hybrid ratios also imply an additional choice of
                relationship between the costs of different fuels.
              </para>
              <para>
                These changes were added to aid modelling the RHI.
              </para>
            </listitem>
            <listitem>
              <para>
                Opimisation with the <xref linkend="ref.in-order"/>
                element
              </para>
              <para>
                To support modelling the renewable heat incentive, the
                <literal>in-order</literal> command has been added. This
                is a fairly flexible command which can perform actions
                in an optimal order presuming certain conditions pertain
                (mainly that the quality of the actions must be
                independent). This can be used to allocate the most
                cost-effective measures subject to supply-chain
                constraints, for example.
              </para>
              <para>
                This was added to support modelling the RHI, and the
                CCC's analysis of the fifth carbon budget.
              </para>
            </listitem>
            <listitem>
              <para>
                Defining supply chains with the
                <xref linkend="ref.consume"/> command
              </para>
              <para>
                As a convenience for representing supply chains, or
                other constrained resources the
                <literal>consume</literal> command has been added.
              </para>
              <para>
                It is an action which either takes some amount off a
                variable representing a limited quantity, or fails if
                there is not enough left for that to be possible. Used
                within a <literal>do</literal> command, it prevents the
                command from exhausting the limited resource.
              </para>
              <para>
                This was added to support modelling the RHI, and the
                CCC's analysis of the fifth carbon budget.
              </para>
            </listitem>
            <listitem>
              <para>
                Computing expected future values (like present cost)
                with <xref linkend="ref.future-value"/>,
                <xref linkend="ref.exponential-discount"/> and
                <xref linkend="ref.house.annual-cost"/>
              </para>
              <para>
                To support modelling the renewable heat incentive, and
                because it will be of wider user, the old
                <literal>npv</literal> function has been superseded by a
                more flexible replacement set of tools.
              </para>
              <para>
                Firstly, the <literal>future-value</literal> element has
                been added; this will predict the (un-discounted) sum of
                any other function over some horizon. To produce a
                discounted sum, the
                <literal>exponential-discount</literal> term has been
                added, which computes an exponentially discounted
                version of another function, when used inside
                <literal>future-value</literal>. Finally, since the
                previous version of npv always computed the discounted
                sum of all annual costs a house would have to pay, the
                <literal>house.annual-cost</literal> element has been
                added.
              </para>
              <para>
                The behaviour of the old NPV can be reproduced with:
              </para>
              <programlisting>
(def-function old-npv
  (+ (net-cost)
     (future-value
      predict:[]
      horizon:10
      (exponential-discount
       rate:5%
      (house.annual-cost)))))
</programlisting>
              <para>
                However, unlike the old NPV, you can modify the function
                to be predicted (so it can be a restricted subset of
                costs, or something which is not a cost), you can change
                the discounting rule to be anything you would like (for
                example, <xref linkend="ref.hyberbolic-discount"/> has
                also been added), and you can control which
                time-sensitive aspects of the calculation should or
                should not be predictable.
              </para>
            </listitem>
            <listitem>
              <para>
                Predicting annual costs with
                <xref linkend="ref.house.annual-cost"/>
              </para>
            </listitem>
            <listitem>
              <para>
                Newly named <xref linkend="ref.capital-cost"/> and
                <xref linkend="ref.net-cost"/>
              </para>
              <para>
                <literal>capital-cost</literal> is a new name for
                <literal>cost.capex</literal>, and
                <literal>net-cost</literal> is a new name for
                <literal>cost.sum</literal>. These were chosen with the
                RHI team, to try and make functions using them more
                readable. Their documentation has also been improved.
              </para>
            </listitem>
            <listitem>
              <para>
                Unified reports with <xref linkend="ref.def-report"/>
              </para>
              <para>
                Aggregate and probe reports have been replaced with a
                single unified syntax for defining a report in the
                <literal>def-report</literal> command.
              </para>
              <para>
                To use this, you write <literal>def-report</literal> in
                your scenario to define a new report, and then you can
                use the <literal>send-to-report</literal> action or the
                <literal>report:</literal> argument on most actions in
                the model to report on a house. For example
              </para>
              <programlisting>
(def-report my-report
  (cut name:by-morphology MORPHOLOGY FORM)

  (column name:ENERGY value: house.energy-use aggregates: [mean min max])
  (column name:MORPHOLOGY value: house.morphology)
  (column name:FORM value: house.built-form))
</programlisting>
              <para>
                Defines three outputs:
              </para>
              <orderedlist spacing="compact">
                <listitem>
                  <para>
                    a disaggregated report with the three named columns,
                    called <literal>my-report</literal>
                  </para>
                </listitem>
                <listitem>
                  <para>
                    a default summary report, with the mean, min and max
                    of the energy column, broken down by where the
                    report is used and the success or failure of measure
                    that communicate with it, called
                    <literal>my-report-summary</literal>
                  </para>
                </listitem>
                <listitem>
                  <para>
                    an additional summary report with the mean, min and
                    max of the energy column broken down by morphology
                    and built form, called
                    <literal>my-report-by-morphology</literal>
                  </para>
                </listitem>
              </orderedlist>
              <para>
                To use the report, you can then write
              </para>
              <programlisting>
(on.dates (regularly)
          (apply (send-to-report my-report)))
</programlisting>
              <para>
                This will update the disaggregated and aggregated
                outputs every year
              </para>
              <para>
                In addition, where you would previously have used a
                <literal>probe</literal> around a measure, you can now
                write:
              </para>
              <programlisting>
(measure.wall-insulation type:cavity ... report: my-report)
</programlisting>
              <para>
                This will log into the report before and after any house
                has this measure applied to it, including information
                about:
              </para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>
                    all the requested columns
                  </para>
                </listitem>
                <listitem>
                  <para>
                    what house is being reported on
                  </para>
                </listitem>
                <listitem>
                  <para>
                    why the house is being reported on (i.e. which
                    measure sent it to the report)
                  </para>
                </listitem>
                <listitem>
                  <para>
                    the date
                  </para>
                </listitem>
                <listitem>
                  <para>
                    whether or not the state of affairs in the report is
                    ultimately selected to become true (for example when
                    used in a choice alternative)
                  </para>
                </listitem>
              </itemizedlist>
              <para>
                This feature was added with the
                <literal>in-order</literal> command, to provide an easy
                way to see disaggregated and aggregated effects of
                performing it. There was no existing feature which would
                allow disaggregated information from such a command.
              </para>
            </listitem>
            <listitem>
              <para>
                Consistent heating fuel with
                <xref linkend="ref.house.heating-fuel"/>
              </para>
              <para>
                The <literal>house.main-heating-fuel</literal> command
                produces an inconsistent coding with all other parts of
                the language that refer to fuels, which used underscores
                to separate words rather than uppercase (so
                <literal>MainsGas</literal> was instead
                <literal>MAINS_GAS</literal>).
                <xref linkend="ref.house.heating-fuel"/> has been added
                as an alternative which uses a consistent coding.
              </para>
              <para>
                This change was made as the confusion caused some
                unexpected mistakes in the development of RHI scenarios.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of <xref linkend="ref.round"/> function
              </para>
              <para>
                The <xref linkend="ref.round"/> function allows you to
                round a numeric value to the nearest, least greater, or
                greatest lesser multiple of of another. This was added
                to help express uncertainties in the renewable heat
                incentive, without having ridiculous degrees of spurious
                precision.
              </para>
            </listitem>
            <listitem>
              <para>
                Increased memory efficiency
              </para>
              <para>
                To support modelling some RHI scenarios, various bits of
                the model have been tuned to be more memory efficient.
                This should also improve the speed of validation, and
                the speed with which large scenarios run. It may also
                marginally reduce the speed with which simpler scenarios
                run, as an unvaoidable trade-off.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Obsolete features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Categorical function
                <xref linkend="ref.house.main-heating-fuel"/>
              </para>
              <para>
                As mentioned, this has been superseded by
                <xref linkend="ref.house.heating-fuel"/>. The old form
                has not been removed, so the semantics of existing
                scenarios are unchanged. However, it is a potential
                pitfall, and ought to be phased out.
              </para>
            </listitem>
            <listitem>
              <para>
                Renaming of <xref linkend="ref.cost.sum"/> and
                <xref linkend="ref.cost.capex"/>
              </para>
              <para>
                As mentioned above, <literal>cost.sum</literal> has been
                renamed to <literal>net-cost</literal> and
                <literal>cost.capex</literal> to
                <literal>capital-cost</literal>. Their meaning is
                unchanged, but their previous naming has repeatedly
                caused some confusion; in particular,
                <literal>net-cost</literal> seems like more appropriate
                terminology.
              </para>
              <para>
                This change was made to clarify the definition of NPV
                functions in RHI and CCC scenarios.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Bugs removed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Delayed actions are no longer scheduled if they are in a
                hypothesis which does not succeed
              </para>
              <para>
                In previous versions, if you used
                <xref linkend="ref.action.delayed"/> within a
                hypothetical which was not selected, the action would
                still be performed. For example, writing
              </para>
              <programlisting>
(under
 (action.delayed
  action: (measure.wall-insulation)
  delay: &quot;0 seconds&quot;)
 evaluate:1)
</programlisting>
              <para>
                Would cause the house to get wall insulation, even
                though the measure was happening in an
                <literal>under</literal> statement and so should have no
                side-effects.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-5.1.4-march-2015">
      <title>Version 5.1.4 [March 2015]</title>
      <orderedlist>
        <listitem>
          <para>
            Semantic Changes
          </para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>
                The addition of <literal>repeat</literal> required a
                change to the way random numbers are stored and moved in
                the scenario. This will change the behaviour of existing
                scenarios which use random numbers. As of this version,
                using a random number within one hypothetical condition
                does not affect the random numbers produced in other
                hypothetical conditions. This means that, for example,
                when the repeat action repeats a use of the
                <literal>sample</literal> command, the same sample is
                produced.
              </para>
            </listitem>
            <listitem>
              <para>
                Insulation measures have been changed so that they will
                no longer validate without having a thickness supplied.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
            New Features
          </para>
          <orderedlist>
            <listitem>
              <para>
                Addition of <xref linkend="ref.scheduling.repeat"/>
              </para>
              <para>
                A new element <xref linkend="ref.scheduling.repeat"/>
                has been added, which can be used inside
                <literal>on.dates</literal> to repeat the execution of
                things like <literal>apply</literal> until a particular
                condition is met.
              </para>
              <para>
                In addition, the repeat element can be configured to
                re-try its actions from scratch, preserving only the
                side-effects on a user-defined list of variables,
                allowing for a very limited kind of optimisation. For
                example, you can repeatedly attempt the offering of a
                subsidised measure with a non-linear takup against
                subsidy level, preserving only changes to the level,
                until sufficiently many measures are taken up.
              </para>
            </listitem>
            <listitem>
              <para>
                Stricter validation of insulation measures
              </para>
              <para>
                All the insulation measures have been modified so that
                they <emphasis>require</emphasis> a value for the
                <literal>thickness:</literal> argument. In previous
                versions, it was legal to write the measures without a
                thickness, but the default value for the thickness,
                resistance and u-value are all zero. The way that the
                model keeps track of the presence of insulation is
                through a change to the thickness, so a measure without
                a thickness would not affect the insulated status of the
                wall, as far as the model is concerned.
              </para>
              <para>
                Since this caused some understandably confusing results,
                a validation rule has been added requiring the thickness
                to be positive.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Bugs removed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Mistake in <xref linkend="ref.decrease"/>
              </para>
              <para>
                In previous versions, the implementation of decrease was
                reversed, so that <literal>(decrease x 1)</literal> was
                equivalent to <literal>(set x (- 1 x))</literal> rather
                than <literal>(set x (- x 1))</literal>.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-5.1.3">
      <title>Version 5.1.3</title>
      <orderedlist>
        <listitem>
          <para>
            Language Changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Improvement of <literal>interpolate</literal>
              </para>
              <para>
                The <xref linkend="ref.interpolate"/> function has been
                improved to support linear interpolation into an
                arbitrary piecewise curve; instead of interpolating
                between two points, you can now specify as many points
                as you like. This is also possible using the
                <literal>lookup-table</literal> macro, but a direct use
                of interpolate may be easier to read and write, and can
                extrapolate beyond the ends of the function if desired.
              </para>
              <para>
                This is intended to be useful for specifying pricing or
                sizing functions derived from real data, and was done
                for modelling the RHI.
              </para>
            </listitem>
            <listitem>
              <para>
                Improvement of <literal>finance.with-loan</literal>
              </para>
              <para>
                <xref linkend="ref.finance.with-loan"/> has been
                improved so that the <literal>term:</literal>,
                <literal>rate:</literal> and <literal>tilt:</literal>
                arguments can all be specified using run-time functions
                rather than fixed constants.
              </para>
              <para>
                These changes were required for modelling the RHI.
              </para>
            </listitem>
            <listitem>
              <para>
                Change to definition of NPV
              </para>
              <para>
                <xref linkend="ref.npv"/> has been redefined so that
                the <literal>discount:</literal> argument is used to
                discount future costs according to a annual geometric
                progression whose multiplier is 1/(1+rate). Previously,
                the discount argument discounted costs according to an
                annual geometric progression with a multiplier of
                (1-rate).
              </para>
              <para>
                This makes the discount rate for NPV analogous to the
                current rate of interest, rather than the degree of
                depreciation of uninvested capital as it was before.
              </para>
              <para>
                This change was required for modelling the RHI.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="version-5.1.2">
      <title>Version 5.1.2</title>
      <para>
        This version number was skipped for reasons to boring to
        describe.
      </para>
    </section>
    <section xml:id="version-5.1.1">
      <title>Version 5.1.1</title>
      <orderedlist>
        <listitem>
          <para>
            Language Changes
          </para>
          <orderedlist>
            <listitem>
              <para>
                Sequencing of probe outputs
              </para>
              <para>
                Probe elements behaviour has been changed so that report
                columns are produced in the same order as the
                <literal>capture:</literal> argument lists them.
                Previously they were produced in alphabetical order. In
                a related change, the documentation for probes has been
                updated to point out that the <literal>name:</literal>
                argument for any probed value can be used to determine
                the column heading in the report.
              </para>
            </listitem>
            <listitem>
              <para>
                Improvement of solar PV model
              </para>
              <para>
                The solar photovoltaic model now distinguishes between
                energy used within the dwelling and energy exported to
                the grid. Scenarios can set the maximum proportion of
                generation which can be used within the dwelling, and a
                new fuel type has been introduced to allow the price for
                exported electricity to differ from the price of
                consumed electricity.
              </para>
            </listitem>
            <listitem>
              <para>
                Improvement of
                <xref linkend="ref.action.remove-fuel-charge"/>
              </para>
              <para>
                <literal>action.remove-fuel-charge</literal> can now be
                used to remove <emphasis>all</emphasis> additional
                charges included in a dwelling's tariff, without having
                to know which charges may have been added. This is
                useful in performing a calculation within an
                <literal>under</literal> function in which you want to
                be sure that a certain set of tariffs are being used,
                such as when calculating a SAP score.
              </para>
            </listitem>
            <listitem>
              <para>
                Addition of random number state to sequence report
              </para>
              <para>
                The sequence report now has an additional column which
                gives the random number generator's internal state after
                each event is processed. This is only useful for
                determining at what point the random behaviour in two
                different runs has diverged.
              </para>
            </listitem>
            <listitem>
              <para>
                Improvements to include and ~module
              </para>
              <para>
                To help with the creation of reusable modules, a new
                include elemnt has been added,
                <literal>include-modules</literal>, which
                <emphasis>only</emphasis> includes modules or other
                <literal>include-modules</literal> statements in the top
                level of the referenced scenario. In addition to this,
                it is now legal to define a module twice; only the first
                definition has any effect.
              </para>
              <para>
                The upshot of this is that if you have modules which
                depend on each other, you no longer need to make sure
                you only include each of these dependencies once.
              </para>
              <para>
                In addition, local names within a module can now be
                written directly by prefacing them with a slash; for
                example, the following
              </para>
              <programlisting>
(~module M
      (template T [] /my-identifier))
</programlisting>
              <para>
                is equivalent to
              </para>
              <programlisting>
(template M/T [] M/my-identifier)
</programlisting>
              <para>
                This special handling also applies to names starting
                with <literal>#/</literal> or <literal>!/</literal>, in
                which cases the module name is inserted before the
                slash, but after the punctuation.
              </para>
            </listitem>
            <listitem>
              <para>
                In-scenario assertions added
              </para>
              <para>
                To make it easier to check scenarios are working as
                intended, the <xref linkend="ref.assert"/> element has
                been added to the language. This can be used within any
                of the scheduling elements (like
                <literal>on.dates</literal>), to test that a given
                condition holds at a certain point in the scenario,
                either for every house in a particular set, or for the
                simulation as a whole. Assertions can be configured to
                produce a warning, or to stop the simulation from
                running if they fail.
              </para>
            </listitem>
            <listitem>
              <para>
                house.insolation element added
              </para>
              <para>
                <xref linkend="ref.house.insolation"/> is a new element
                which lets you determine the average amount of
                insolation on an inclined plane under current weather
                conditions for the house, in kWh/year.
              </para>
              <para>
                This was added to support modelling the RHI,
                specifically to implement the MCS methodology for sizing
                solar thermal.
              </para>
            </listitem>
            <listitem>
              <para>
                house.air-change-rate added
              </para>
              <para>
                <xref linkend="ref.house.air-change-rate"/> is a new
                element which lets you access the energy calculator's
                prediction of the air change rate within a house.
              </para>
            </listitem>
            <listitem>
              <para>
                house.volume added
              </para>
              <para>
                <xref linkend="ref.house.volume"/> is a new element
                which provides the volume of a house in cubic metres.
              </para>
            </listitem>
            <listitem>
              <para>
                house.heat-load added
              </para>
              <para>
                <xref linkend="ref.house.heat-load"/> is a new element
                which provides the mean heat load in a house. It was
                added to support modelling the RHI.
              </para>
            </listitem>
            <listitem>
              <para>
                Simpler referencing
              </para>
              <para>
                In previous versions of the NHM, references to
                previously defined variables, actions, tests and so on
                had to be preceded with a <literal>#</literal> symbol.
                It is now possible simply to use the name, without a
                <literal>#</literal> symbol, although the old syntax is
                still supported.
              </para>
            </listitem>
            <listitem>
              <para>
                Improved error messages
              </para>
              <para>
                The error messages associated with some common scenario
                mistakes have been improved, to better signal the nature
                of the error.
              </para>
            </listitem>
            <listitem>
              <para>
                Bounds checking on values calculated at runtime
              </para>
              <para>
                Most values which are computed at runtime are now
                bounds-checked, and warnings will be generated if they
                are not sensible. Checked values include heating system
                efficiencies, sizes, capex, opex, and hot water tank
                sizes; for example, if a measure's pricing function
                produces a negative price, a warning will be generated
                and the price will be clamped to zero.
              </para>
            </listitem>
            <listitem>
              <para>
                Profiling information
              </para>
              <para>
                The top-level scenario element now has an argument
                <literal>profile-depth:</literal> which can be used to
                profile the running of your scenarios; if it is set to a
                positive number, an additional report will be generated
                showing how long different parts of the scenario are
                taking to run.
              </para>
            </listitem>
            <listitem>
              <para>
                Multiple-value set, with counterfactuals
              </para>
              <para>
                The <literal>set</literal> action can now set multiple
                values at once, and can impose a counterfactual
                condition for computing those values. This makes it a
                more efficient alternative to repeated use of the
                <literal>under</literal> function, for example in the
                case where disaggregated fuel use is required under some
                complex set of counterfactual assumptions:
              </para>
              <programlisting>
(set
      [mains-gas electricity]
      [(house.energy-use by-fuel:mainsgas) (house.energy-use by-fuel:peakelectricity)]
      under:(my-assumptions-template))
</programlisting>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            Bugs Fixed
          </para>
          <orderedlist>
            <listitem>
              <para>
                Uninsulated lofts imported correctly
              </para>
              <para>
                An oversight in the stock import code which meant that
                only dwellings with some loft insulation were considered
                to have a loft has been corrected; the EHS variable
                <literal>FLITYPES</literal> in the
                <literal>services</literal> file is now used to
                determine the presence of a loft. This increases the
                number of dwellings suitable for loft insulation in most
                stocks.
              </para>
            </listitem>
            <listitem>
              <para>
                Non-determinism eliminated
              </para>
              <para>
                A programming error which produced a very occasional
                non-determinism between runs has been eliminated,
                ensuring total repeatability of pseudorandom model
                behaviour.
              </para>
            </listitem>
            <listitem>
              <para>
                Validation faults corrected
              </para>
              <para>
                A fault in <literal>set</literal> which broke the
                validator when the first argument (the variable to set)
                could not be resolved has been corrected.
              </para>
              <para>
                Various other validation errors have been made more
                informative.
              </para>
            </listitem>
            <listitem>
              <para>
                Energy calculation ventilation effects corrected
              </para>
              <para>
                A fault in the energy calculator has been corrected.
                Previously, the SAP adjustment which increases household
                ventilation in low-ventilation buildings was applied
                <emphasis>before</emphasis> the SAP adjustment which
                takes account of local wind speed when calculating the
                air change rate for a house. This caused a small excess
                increase in air change rate for those houses in which
                the structural air change rate was below 1, but the
                effect of local exposure would have raised it above one.
                The adjustments are now applied in the correct order
                (exposure effects first, occupants' adjustment second).
              </para>
              <para>
                The effect of the correction is small; under SAP 2012
                assumptions, for the EHS 2012 stock, the mean energy use
                has decreased from 22772.73 kWh/year to 22753.2
                kWh/year. The maximum has been reduced from 323656 to
                323616, and the minimum from 3206 to 3162
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="previous-versions">
      <title>Previous versions</title>
      <para>
        This changelog ends here; there are changelogs for previous
        versions stored in the source control system, which are
        available on request.
      </para>
    </section>
  </section>
  <section xml:id="future-features">
    <title>Future features</title>
    <para>
      These are features which have been requested for future versions.
    </para>
    <section xml:id="commands-to-create-houses-from-archetypes">
      <title>Commands to create houses from archetypes</title>
      <para>
        At the moment houses can be copied with
        <xref linkend="ref.action.construct"/> or destroyed with
        <xref linkend="ref.action.demolish"/>. These commands are of
        limited use because:
      </para>
      <itemizedlist spacing="compact">
        <listitem>
          <para>
            They can only create copies of existing houses
          </para>
        </listitem>
        <listitem>
          <para>
            They cannot reweight the copies
          </para>
        </listitem>
      </itemizedlist>
      <para>
        In a future version, the stock will be extended to allow storage
        of <emphasis>archetypal</emphasis> houses, with zero weight,
        which represent buildings that might be constructed in the
        future. New language commands will allow you to construct new
        houses within simulation by creating them from the archetypes in
        the stock. This will allow you to define expectations for new
        build, without having to find analogous existing houses and copy
        them.
      </para>
    </section>
  </section>
</chapter>
